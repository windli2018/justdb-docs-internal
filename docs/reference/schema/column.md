---
icon: columns
title: 列定义
order: 3
category:
  - 参考文档
  - Schema 定义
tag:
  - column
  - schema
---

# 列定义 (Column)

列（Column）是表的基本组成单元，定义了数据的类型、约束和默认值等属性。

## 基本属性

| 属性 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `id` | String | 否 | 唯一标识符，用于引用 |
| `name` | String | 是 | 列名 |
| `referenceId` | String | 否 | 引用其他列的 id |
| `formerNames` | List&lt;String&gt; | 否 | 曾用名列表，用于追踪重命名 |
| `type` | String | 是 | 数据类型 |
| `nullable` | Boolean | 否 | 是否可空（默认 true） |
| `defaultValue` | String | 否 | 默认值 |
| `defaultValueComputed` | String | 否 | 计算型默认值（如函数） |
| `autoIncrement` | Boolean | 否 | 是否自增（默认 false） |
| `sequence` | String | 否 | 关联序列名 |
| `primaryKey` | Boolean | 否 | 是否主键（默认 false） |
| `primaryKeyName` | String | 否 | 主键约束名称 |
| `comment` | String | 否 | 数据库注释 |
| `remark` | String | 否 | JustDB 备注 |
| `dbms` | List&lt;String&gt; | 否 | 适用数据库列表 |

## 数据类型

### 字符串类型

| 类型 | 说明 | 示例 |
|------|------|------|
| `CHAR(n)` | 固定长度字符串 | `CHAR(10)` |
| `VARCHAR(n)` | 可变长度字符串 | `VARCHAR(255)` |
| `TEXT` | 长文本 | `TEXT` |
| `LONGTEXT` | 超长文本 | `LONGTEXT` |
| `CLOB` | 字符大对象 | `CLOB` |

```yaml
Column:
  - name: username
    type: VARCHAR(50)
    nullable: false

  - name: bio
    type: TEXT
    comment: 个人简介

  - name: code
    type: CHAR(10)
    nullable: false
```

### 数值类型

| 类型 | 说明 | 示例 |
|------|------|------|
| `TINYINT` | 微整数 | `TINYINT` |
| `SMALLINT` | 小整数 | `SMALLINT` |
| `INT` / `INTEGER` | 整数 | `INT` |
| `BIGINT` | 大整数 | `BIGINT` |
| `DECIMAL(p,s)` | 精确小数 | `DECIMAL(10,2)` |
| `FLOAT` | 单精度浮点 | `FLOAT` |
| `DOUBLE` | 双精度浮点 | `DOUBLE` |

```yaml
Column:
  - name: age
    type: INT
    comment: 年龄

  - name: balance
    type: DECIMAL(10,2)
    defaultValue: 0.00
    comment: 余额

  - name: rating
    type: DOUBLE
    defaultValue: 0.0
    comment: 评分
```

### 日期时间类型

| 类型 | 说明 | 示例 |
|------|------|------|
| `DATE` | 日期 | `DATE` |
| `TIME` | 时间 | `TIME` |
| `DATETIME` | 日期时间 | `DATETIME` |
| `TIMESTAMP` | 时间戳 | `TIMESTAMP` |
| `YEAR` | 年份 | `YEAR` |

```yaml
Column:
  - name: birth_date
    type: DATE
    comment: 出生日期

  - name: created_at
    type: TIMESTAMP
    nullable: false
    defaultValueComputed: CURRENT_TIMESTAMP
    comment: 创建时间

  - name: updated_at
    type: TIMESTAMP
    nullable: false
    defaultValueComputed: CURRENT_TIMESTAMP
    comment: 更新时间
```

### 布尔类型

| 类型 | 说明 | 示例 |
|------|------|------|
| `BOOLEAN` / `BOOL` | 布尔值 | `BOOLEAN` |
| `BIT` | 位 | `BIT(1)` |

```yaml
Column:
  - name: is_active
    type: BOOLEAN
    defaultValue: true
    comment: 是否激活

  - name: is_deleted
    type: BOOLEAN
    defaultValue: false
    comment: 是否删除
```

### 二进制类型

| 类型 | 说明 | 示例 |
|------|------|------|
| `BINARY(n)` | 固定长度二进制 | `BINARY(16)` |
| `VARBINARY(n)` | 可变长度二进制 | `VARBINARY(255)` |
| `BLOB` | 二进制大对象 | `BLOB` |

```yaml
Column:
  - name: avatar
    type: BLOB
    comment: 头像

  - name: file_data
    type: LONGBLOB
    comment: 文件数据
```

### JSON 类型

| 类型 | 说明 | 示例 |
|------|------|------|
| `JSON` | JSON 数据 | `JSON` |
| `JSONB` | 二进制 JSON（PostgreSQL） | `JSONB` |

```yaml
Column:
  - name: metadata
    type: JSON
    comment: 元数据

  - name: settings
    type: JSONB
    dbms: [postgresql]
    comment: 设置（PostgreSQL）
```

## 约束

### 主键约束

```yaml
Column:
  - name: id
    type: BIGINT
    primaryKey: true
    autoIncrement: true
```

### 非空约束

```yaml
Column:
  - name: email
    type: VARCHAR(100)
    nullable: false
```

### 唯一约束

列级别的唯一约束通过索引实现：

```yaml
Table:
  - name: users
    Column:
      - name: email
        type: VARCHAR(100)
    Index:
      - name: idx_users_email
        columns: [email]
        unique: true
```

### 检查约束

```yaml
Column:
  - name: age
    type: INT
    check: age >= 0 AND age <= 150
```

## 默认值

### 静态默认值

```yaml
Column:
  - name: status
    type: VARCHAR(20)
    defaultValue: 'active'

  - name: count
    type: INT
    defaultValue: 0

  - name: price
    type: DECIMAL(10,2)
    defaultValue: 0.00
```

### 计算型默认值

```yaml
Column:
  - name: created_at
    type: TIMESTAMP
    nullable: false
    defaultValueComputed: CURRENT_TIMESTAMP

  - name: updated_at
    type: TIMESTAMP
    nullable: false
    defaultValueComputed: CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
```

### NULL 默认值

```yaml
Column:
  - name: deleted_at
    type: TIMESTAMP
    defaultValue: null
    comment: 删除时间
```

## 自增和序列

### 自增列

```yaml
Column:
  - name: id
    type: BIGINT
    primaryKey: true
    autoIncrement: true
```

不同数据库生成的 SQL：
- **MySQL**: `id BIGINT AUTO_INCREMENT PRIMARY KEY`
- **PostgreSQL**: `id BIGSERIAL PRIMARY KEY`
- **Oracle**: `id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY`

### 使用序列

```yaml
Sequence:
  - name: seq_user_id
    startWith: 1
    incrementBy: 1

Column:
  - name: id
    type: BIGINT
    primaryKey: true
    sequence: seq_user_id
```

## 继承和覆盖

### 使用 referenceId 继承

```yaml
# 全局列定义
Column:
  - id: global_id
    name: id
    type: BIGINT
    primaryKey: true
    autoIncrement: true

  - id: global_created_at
    name: created_at
    type: TIMESTAMP
    nullable: false
    defaultValueComputed: CURRENT_TIMESTAMP

# 在表中引用
Table:
  - name: users
    Column:
      - id: col_users_id
        referenceId: global_id
        name: id

      - name: username
        type: VARCHAR(50)

      - id: col_users_created_at
        referenceId: global_created_at
        name: created_at
```

### 覆盖父定义

```yaml
Column:
  - id: global_status
    name: status
    type: VARCHAR(20)
    defaultValue: 'pending'

Table:
  - name: users
    Column:
      - referenceId: global_status
        name: status
        isOverride: true
        defaultValue: 'active'  # 覆盖默认值
```

## 列重命名

使用 `formerNames` 追踪列重命名：

```yaml
Table:
  - name: users
    Column:
      - name: user_name
        formerNames: [username]
        type: VARCHAR(50)
        nullable: false
```

生成的迁移 SQL：
```sql
ALTER TABLE users CHANGE COLUMN username user_name VARCHAR(50) NOT NULL;
```

## 数据库特定配置

### MySQL 特定配置

```yaml
Column:
  - name: data
    type: VARCHAR(255)
    characterSet: utf8mb4
    collation: utf8mb4_unicode_ci
```

### PostgreSQL 特定配置

```yaml
Column:
  - name: id
    type: BIGINT
    primaryKey: true
    dbms: [postgresql]

  - name: settings
    type: JSONB
    dbms: [postgresql]
```

## 生命周期钩子

列支持生命周期钩子：

```yaml
Table:
  - name: users
    Column:
      - name: email
        type: VARCHAR(100)
        afterAlters:
          - content: |
              UPDATE users SET email = LOWER(email) WHERE email IS NOT NULL
```

## 完整示例

### 用户表列定义

```yaml
Table:
  - name: users
    comment: 用户表
    Column:
      # 主键
      - name: id
        type: BIGINT
        primaryKey: true
        autoIncrement: true
        comment: 用户ID

      # 用户名
      - name: username
        type: VARCHAR(50)
        nullable: false
        comment: 用户名

      # 邮箱
      - name: email
        type: VARCHAR(100)
        comment: 邮箱

      # 密码哈希
      - name: password_hash
        type: VARCHAR(255)
        nullable: false
        comment: 密码哈希

      # 手机号
      - name: phone
        type: VARCHAR(20)
        comment: 手机号

      # 状态
      - name: status
        type: VARCHAR(20)
        defaultValue: 'active'
        nullable: false
        comment: 用户状态

      # 是否激活
      - name: is_active
        type: BOOLEAN
        defaultValue: true
        comment: 是否激活

      # 是否删除
      - name: is_deleted
        type: BOOLEAN
        defaultValue: false
        comment: 是否删除

      # 创建时间
      - name: created_at
        type: TIMESTAMP
        nullable: false
        defaultValueComputed: CURRENT_TIMESTAMP
        comment: 创建时间

      # 更新时间
      - name: updated_at
        type: TIMESTAMP
        nullable: false
        defaultValueComputed: CURRENT_TIMESTAMP
        comment: 更新时间

      # 删除时间
      - name: deleted_at
        type: TIMESTAMP
        defaultValue: null
        comment: 删除时间

      # 最后登录时间
      - name: last_login_at
        type: TIMESTAMP
        defaultValue: null
        comment: 最后登录时间

      # 元数据
      - name: metadata
        type: JSON
        comment: 元数据

      # 备注
      - name: remark
        type: TEXT
        comment: 备注
```

## 最佳实践

### 1. 命名规范

- 列名使用小写字母和下划线
- 使用描述性名称，避免缩写
- 布尔列使用 `is_` 前缀

```yaml
# 推荐
Column:
  - name: is_active
  - name: created_at
  - name: user_id

# 不推荐
Column:
  - name: active
  - name: createtime
  - name: uid
```

### 2. 字符串长度

根据实际需求设置合适的长度：

```yaml
Column:
  - name: country_code
    type: CHAR(2)  # 固定长度

  - name: username
    type: VARCHAR(50)  # 可变长度

  - name: description
    type: TEXT  # 长文本
```

### 3. 时间戳字段

始终使用 `TIMESTAMP` 类型并设置默认值：

```yaml
Column:
  - name: created_at
    type: TIMESTAMP
    nullable: false
    defaultValueComputed: CURRENT_TIMESTAMP

  - name: updated_at
    type: TIMESTAMP
    nullable: false
    defaultValueComputed: CURRENT_TIMESTAMP
```

### 4. 软删除

使用软删除代替物理删除：

```yaml
Column:
  - name: is_deleted
    type: BOOLEAN
    defaultValue: false

  - name: deleted_at
    type: TIMESTAMP
    defaultValue: null
```

### 5. 金额字段

使用 `DECIMAL` 类型存储金额：

```yaml
Column:
  - name: amount
    type: DECIMAL(10,2)  # 10位数字，2位小数
```

## 常见问题

### 如何添加枚举类型？

使用检查约束：

```yaml
Column:
  - name: status
    type: VARCHAR(20)
    nullable: false
    defaultValue: 'pending'
    comment: 状态

# 在表级别添加检查约束
Table:
  - name: orders
    Column:
      - name: status
    Constraint:
      - name: chk_orders_status
        type: CHECK
        checkExpression: status IN ('pending', 'processing', 'completed', 'cancelled')
```

### 如何存储 IP 地址？

```yaml
Column:
  - name: ip_address
    type: VARCHAR(45)  # IPv6 最长 45 字符
    comment: IP地址

  # 或使用整数存储（IPv4）
  - name: ip_int
    type: BIGINT
    comment: IP地址（整数形式）
```

### 如何存储 UUID？

```yaml
Column:
  - name: uuid
    type: CHAR(36)  # UUID 标准格式
    comment: UUID

  # 或使用二进制
  - name: uuid_binary
    type: BINARY(16)
    comment: UUID（二进制）
```

## 相关文档

- [表定义](./table.md)
- [约束定义](./constraint.md)
- [格式支持 - YAML](../formats/yaml.md)
