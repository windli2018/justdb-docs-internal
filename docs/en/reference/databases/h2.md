# H2 Database Support

JustDB provides complete H2 database support, including embedded mode and server mode.

## Version Support

| Version | Status | Notes |
|---------|--------|-------|
| H2 2.x | Full Support | Latest stable version |
| H2 1.4.x | Full Support | Stable version |

## Connection Configuration

### JDBC Driver

```xml
<dependency>
    <groupId>com.h2database</groupId>
    <artifactId>h2</artifactId>
    <version>2.1.210</version>
</dependency>
```

### Connection String

#### Embedded Mode

```bash
# Basic format
jdbc:h2:{file}

# Examples
jdbc:h2:~/test
jdbc:h2:/data/sample
jdbc:h2:./mydb
```

#### Server Mode

```bash
# Basic format
jdbc:h2:tcp://{host}[:{port}]/[{database}]

# Examples
jdbc:h2:tcp://localhost:9092/~/test
jdbc:h2:tcp://192.168.1.100:9092/data/sample
```

#### In-Memory Mode

```bash
# Basic format
jdbc:h2:mem:{database}

# Examples
jdbc:h2:mem:test
jdbc:h2:mem:test_db;DB_CLOSE_DELAY=-1
```

### Configuration Examples

**YAML:**
```yaml
databases:
  production:
    url: jdbc:h2:tcp://localhost:9092/~/test
    driver: org.h2.Driver
    username: sa
    password: ""
    dialect: h2
```

**JSON:**
```json
{
  "databases": {
    "production": {
      "url": "jdbc:h2:tcp://localhost:9092/~/test",
      "driver": "org.h2.Driver",
      "username": "sa",
      "password": "",
      "dialect": "h2"
    }
  }
}
```

**XML:**
```xml
<databases>
  <database id="production">
    <url>jdbc:h2:tcp://localhost:9092/~/test</url>
    <driver>org.h2.Driver</driver>
    <username>sa</username>
    <password></password>
    <dialect>h2</dialect>
  </database>
</databases>
```

## Data Type Mapping

### Numeric Types

| JustDB Type | H2 Type | JDBC Type | Java Type | Description |
|-------------|---------|-----------|-----------|-------------|
| TINYINT | TINYINT | TINYINT | Integer | 1-byte integer |
| SMALLINT | SMALLINT | SMALLINT | Integer | 2-byte integer |
| INTEGER | INT | INTEGER | Integer | 4-byte integer |
| BIGINT | BIGINT | BIGINT | Long | 8-byte integer |
| DECIMAL | DECIMAL(p,s) | DECIMAL | BigDecimal | Exact numeric |
| NUMERIC | NUMERIC(p,s) | NUMERIC | BigDecimal | Exact numeric |
| FLOAT | REAL | FLOAT | Float | Single-precision float |
| DOUBLE | DOUBLE | DOUBLE | Double | Double-precision float |

### String Types

| JustDB Type | H2 Type | JDBC Type | Java Type | Description |
|-------------|---------|-----------|-----------|-------------|
| CHAR | CHAR(n) | CHAR | String | Fixed-length string |
| VARCHAR | VARCHAR(n) | VARCHAR | String | Variable-length string |
| CLOB | CLOB | CLOB | String | Large text |
| VARCHAR_IGNORECASE | VARCHAR_IGNORECASE | VARCHAR | String | Case-insensitive |

### Date/Time Types

| JustDB Type | H2 Type | JDBC Type | Java Type | Description |
|-------------|---------|-----------|-----------|-------------|
| DATE | DATE | DATE | Date | Date |
| TIME | TIME(n) | TIME | Time | Time |
| TIMESTAMP | TIMESTAMP(n) | TIMESTAMP | Timestamp | Timestamp |
| TIMESTAMP_WITH_TIMEZONE | TIMESTAMP WITH TIME ZONE | TIMESTAMP_WITH_TIMEZONE | Timestamp | Timestamp with timezone |

### Binary Types

| JustDB Type | H2 Type | JDBC Type | Java Type | Description |
|-------------|---------|-----------|-----------|-------------|
| BINARY | BINARY(n) | BINARY | byte[] | Fixed-length binary |
| VARBINARY | VARBINARY(n) | VARBINARY | byte[] | Variable-length binary |
| BLOB | BLOB | BLOB | byte[] | Binary large object |

### Other Types

| JustDB Type | H2 Type | JDBC Type | Java Type | Description |
|-------------|---------|-----------|-----------|-------------|
| BOOLEAN | BOOLEAN | BOOLEAN | Boolean | Boolean value |
| UUID | UUID | UUID | String/UUID | UUID identifier |
| ARRAY | ARRAY | ARRAY | Array | Array type |
| GEOMETRY | GEOMETRY | GEOMETRY | byte[] | Geometry type |
| JSON | JSON | JSON | String | JSON data (H2 2.x+) |
| ENUM | ENUM | VARCHAR | String | Enumeration type |

## H2-Specific Features

### AUTO_INCREMENT

```yaml
tables:
  - name: users
    columns:
      - name: id
        type: BIGINT
        primaryKey: true
        autoIncrement: true
```

### Memory Table Options

```yaml
tables:
  - name: cache
    engine: MEMORY  # Memory table
    columns:
      - name: key
        type: VARCHAR(255)
        primaryKey: true
```

### Temporary Table

```yaml
tables:
  - name: temp_data
    temporary: true
    columns:
      - name: data
        type: TEXT
```

### Column Default Value

```yaml
tables:
  - name: users
    columns:
      - name: created_at
        type: TIMESTAMP
        defaultValueComputed: "CURRENT_TIMESTAMP"
```

## Generated SQL Examples

### CREATE TABLE

```sql
CREATE TABLE IF NOT EXISTS users (
  id BIGINT AUTO_INCREMENT PRIMARY KEY,
  username VARCHAR(255) NOT NULL,
  email VARCHAR(255) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### ALTER TABLE

```sql
-- Add column
ALTER TABLE users ADD COLUMN status VARCHAR(50) DEFAULT 'active' NOT NULL;

-- Modify column type
ALTER TABLE users ALTER COLUMN email VARCHAR(500);

-- Modify column constraint
ALTER TABLE users ALTER COLUMN email SET NOT NULL;

-- Rename column
ALTER TABLE users RENAME COLUMN username TO login_name;

-- Drop column
ALTER TABLE users DROP COLUMN status;
```

### CREATE INDEX

```sql
CREATE INDEX IF NOT EXISTS idx_username ON users (username);
CREATE UNIQUE INDEX IF NOT EXISTS idx_email ON users (email);
```

### DROP TABLE

```sql
DROP TABLE IF EXISTS users;
```

## Known Limitations

### Differences from Other Databases

1. **Stored Procedures**: H2 stored procedure syntax differs from MySQL/Oracle
2. **Triggers**: H2 triggers are written in Java
3. **Full-Text Index**: H2 full-text index implementation is different
4. **Views**: H2 view functionality is relatively simple

### Data Type Limitations

1. **ENUM**: H2 2.x supports ENUM but syntax differs
2. **JSON**: H2 2.x+ supports JSON but functionality is relatively simple
3. **GEOMETRY**: Spatial type support is limited

## Best Practices

### 1. Use In-Memory Database for Testing

```yaml
databases:
  test:
    url: jdbc:h2:mem:test_db;DB_CLOSE_DELAY=-1
    driver: org.h2.Driver
    username: sa
    password: ""
    dialect: h2
```

### 2. Use AUTO_INCREMENT

```yaml
tables:
  - name: users
    columns:
      - name: id
        type: BIGINT
        primaryKey: true
        autoIncrement: true
```

### 3. Leverage IF EXISTS/IF NOT EXISTS

```yaml
# H2 fully supports IF EXISTS and IF NOT EXISTS
tables:
  - name: users
    idempotent: true
```

### 4. Use CLOB for Large Text

```yaml
tables:
  - name: posts
    columns:
      - name: content
        type: CLOB
```

### 5. Use Memory Tables for Performance

```yaml
tables:
  - name: cache
    engine: MEMORY  # Memory table, faster access
```

## Use Cases

### 1. Development and Testing

H2 is ideal for development and testing environments:

```yaml
databases:
  development:
    url: jdbc:h2:./dev_db
    dialect: h2
```

### 2. Unit Testing

Use in-memory database to accelerate testing:

```yaml
databases:
  test:
    url: jdbc:h2:mem:test;DB_CLOSE_DELAY=-1;MODE=MySQL
    dialect: h2
```

### 3. Embedded Applications

Directly embed into application:

```yaml
databases:
  embedded:
    url: jdbc:h2:./data/app_db
    dialect: h2
```

### 4. Server Mode

Multi-client connections:

```yaml
databases:
  server:
    url: jdbc:h2:tcp://localhost:9092/~/production
    dialect: h2
```

## Compatibility Mode

H2 can simulate other database syntax:

```bash
# MySQL compatibility mode
jdbc:h2:mem:test;MODE=MySQL

# PostgreSQL compatibility mode
jdbc:h2:mem:test;MODE=PostgreSQL

# Oracle compatibility mode
jdbc:h2:mem:test;MODE=Oracle

# SQL Server compatibility mode
jdbc:h2:mem:test;MODE=MSSQLServer
```

## Performance Optimization

### 1. Connection Pool Configuration

```yaml
databases:
  production:
    url: jdbc:h2:tcp://localhost:9092/~/test;CACHE_SIZE=65536
    dialect: h2
    pool:
      maxSize: 10
      minIdle: 2
```

### 2. Page Size Adjustment

```bash
jdbc:h2:./test;PAGE_SIZE=16384
```

### 3. Compression Options

```bash
jdbc:h2:./test;COMPRESS=TRUE
```

## Related Documentation

- [H2 Official Documentation](https://www.h2database.com/html/main.html)
- [H2 Data Type Reference](https://www.h2database.com/html/datatypes.html)
- [Database Support Overview](./README.md)
