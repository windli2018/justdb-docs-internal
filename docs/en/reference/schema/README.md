---
icon: table
title: Schema Definition Overview
order: 1
category:
  - Reference
  - Schema Definition
tag:
  - schema
  - reference
---

# Schema Definition Overview

JustDB Schema is a declarative framework for describing database structures. Through schema definitions, you can describe database objects like tables, columns, indexes, and constraints in a database-agnostic way, and JustDB will automatically generate DDL statements for different databases.

## Core Concepts

### Justdb (Root Node)

`Justdb` is the root node of schema definitions, containing all database object definitions:

```yaml
id: myapp
namespace: com.example
Table:
  - name: users
    Column:
      - name: id
        type: BIGINT
        primaryKey: true
```

### Schema Object Hierarchy

```
Justdb (root node)
├── Database       # Database definition
├── Table          # Table definition
├── Column         # Column definition (global)
├── View           # View definition
├── Query          # Query definition
├── Index          # Index definition (global)
├── Constraint     # Constraint definition (global)
├── Trigger        # Trigger definition
├── Sequence       # Sequence definition
├── Procedure      # Stored procedure definition
└── Data           # Data export definition
```

### Item (Base Item)

All schema objects inherit from the `Item` base class, providing the following common properties:

| Property | Type | Description |
|----------|------|-------------|
| `id` | String | Unique identifier for referencing |
| `name` | String | Object name |
| `referenceId` | String | Reference to another object's id |
| `formerNames` | List<String> | List of former names for tracking renames |
| `comment` | String | Database comment (written to database) |
| `remark` | String | JustDB note (not written to database) |
| `author` | String | Author information |
| `version` | String | Version information |
| `dbms` | List<String> | Applicable database list |

## Core Features

### 1. Database Agnostic

The same schema can generate DDL for multiple databases:

```yaml
Table:
  - name: users
    Column:
      - name: id
        type: BIGINT
        primaryKey: true
        autoIncrement: true
```

Generated results:
- **MySQL**: `id BIGINT AUTO_INCREMENT PRIMARY KEY`
- **PostgreSQL**: `id BIGSERIAL PRIMARY KEY`
- **Oracle**: `id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY`

### 2. Component Reuse (referenceId)

Implement component reuse through `referenceId`:

```yaml
# Global column definition
Column:
  - id: global_id
    name: id
    type: BIGINT
    primaryKey: true
    autoIncrement: true

# Reference in tables
Table:
  - name: users
    Column:
      - id: col_users_id
        referenceId: global_id  # Reference global definition
        name: id

  - name: orders
    Column:
      - id: col_orders_id
        referenceId: global_id  # Reuse same definition
        name: id
```

### 3. Schema Evolution Tracking (formerNames)

Track object renames through `formerNames`:

```yaml
Table:
  - name: users
    formerNames: [user]  # Record former name
    Column:
      - name: user_name
        formerNames: [username]  # Column rename
        type: VARCHAR(50)
```

Generated migration SQL:
```sql
ALTER TABLE user RENAME TO users;
ALTER TABLE users CHANGE COLUMN username user_name VARCHAR(50);
```

### 4. Lifecycle Hooks

Execute custom SQL before/after DDL operations:

```yaml
Table:
  - name: users
    afterCreates:
      - dbms: postgresql
        content: CREATE INDEX CONCURRENTLY idx_users_username ON users(username);
      - dbms: mysql
        content: CREATE INDEX idx_users_username ON users(username);
```

### 5. Conditional Execution

Conditional execution based on database type:

```yaml
Table:
  - name: products
    afterCreates:
      - dbms: [postgresql, timescaledb]
        content: CREATE INDEX CONCURRENTLY idx_products_created_at ON products(created_at);
```

## Schema Object Details

### Table (Table)

Tables are the core objects in databases for storing data. See [Table Definition](./table.md).

```yaml
Table:
  - id: table_users
    name: users
    comment: User table
    Column:
      - name: id
        type: BIGINT
        primaryKey: true
      - name: username
        type: VARCHAR(50)
        nullable: false
```

### Column (Column)

Columns define table structure, including data types and constraints. See [Column Definition](./column.md).

```yaml
Column:
  - name: email
    type: VARCHAR(100)
    nullable: true
    defaultValue: null
    comment: Email address
```

### Index (Index)

Indexes improve query performance. See [Index Definition](./index.md).

```yaml
Index:
  - id: idx_users_email
    name: idx_users_email
    tableName: users
    columns: [email]
    unique: true
```

### Constraint (Constraint)

Constraints ensure data integrity. See [Constraint Definition](./constraint.md).

```yaml
Constraint:
  - id: fk_orders_user_id
    name: fk_orders_user_id
    type: FOREIGN_KEY
    tableName: orders
    referencedTable: users
    referencedColumn: id
```

### View (View)

Views are virtual tables based on query results. See [View Definition](./view.md).

```yaml
View:
  - name: active_users
    content: SELECT * FROM users WHERE status = 'active'
```

### Sequence (Sequence)

Sequences generate unique numeric values. See [Sequence Definition](./sequence.md).

```yaml
Sequence:
  - name: seq_user_id
    startWith: 1
    incrementBy: 1
```

### Trigger (Trigger)

Triggers execute automatically when specific events occur. See [Trigger Definition](./trigger.md).

```yaml
Trigger:
  - name: trg_users_update_timestamp
    tableName: users
    event: UPDATE
    timing: BEFORE
    content: NEW.updated_at = CURRENT_TIMESTAMP
```

### Procedure (Stored Procedure)

Stored procedures are precompiled SQL statement collections. See [Procedure Definition](./procedure.md).

```yaml
Procedure:
  - name: sp_create_user
    parameters:
      - name: p_username
        type: VARCHAR(50)
      - name: p_email
        type: VARCHAR(100)
    content: |
      INSERT INTO users (username, email) VALUES (p_username, p_email);
```

### Lifecycle Hooks

Lifecycle hooks allow executing custom logic during DDL operations. See [Lifecycle Hooks](./lifecycle-hooks.md).

Supported hook types:
- `beforeCreates` / `afterCreates`
- `beforeDrops` / `afterDrops`
- `beforeAlters` / `afterAlters`
- `beforeAdds` / `afterAdds`

## Quick Example

### Complete User Management System Schema

```yaml
id: user-management
namespace: com.example

# Global column definitions
Column:
  - id: global_id
    name: id
    type: BIGINT
    primaryKey: true
    autoIncrement: true

  - id: global_created_at
    name: created_at
    type: TIMESTAMP
    nullable: false
    defaultValueComputed: CURRENT_TIMESTAMP

  - id: global_updated_at
    name: updated_at
    type: TIMESTAMP
    nullable: false
    defaultValueComputed: CURRENT_TIMESTAMP

# Users table
Table:
  - id: table_users
    name: users
    comment: User table
    Column:
      - id: col_users_id
        referenceId: global_id
        name: id

      - name: username
        type: VARCHAR(50)
        nullable: false
        comment: Username

      - name: email
        type: VARCHAR(100)
        comment: Email

      - id: col_users_created_at
        referenceId: global_created_at
        name: created_at

      - id: col_users_updated_at
        referenceId: global_updated_at
        name: updated_at

    Index:
      - name: idx_users_username
        columns: [username]
        unique: true

      - name: idx_users_email
        columns: [email]
        unique: true

# Orders table
  - id: table_orders
    name: orders
    comment: Orders table
    Column:
      - id: col_orders_id
        referenceId: global_id
        name: id

      - name: user_id
        type: BIGINT
        nullable: false
        comment: User ID

      - name: total_amount
        type: DECIMAL(10,2)
        defaultValue: 0.00
        comment: Order amount

      - id: col_orders_created_at
        referenceId: global_created_at
        name: created_at

    Constraint:
      - id: fk_orders_user_id
        name: fk_orders_user_id
        type: FOREIGN_KEY
        referencedTable: users
        referencedColumn: id
        columns: [user_id]

# Active users view
View:
  - name: active_users
    comment: Active users view
    content: |
      SELECT *
      FROM users
      WHERE last_login_at >= DATE_SUB(NOW(), INTERVAL 30 DAY)
```

## Related Documentation

- [Table Definition](./table.md) *(Coming soon)*
- [Column Definition](./column.md) *(Coming soon)*
- [Index Definition](./index.md) *(Coming soon)*
- [Constraint Definition](./constraint.md) *(Coming soon)*
- [View Definition](./view.md) *(Coming soon)*
- [Sequence Definition](./sequence.md) *(Coming soon)*
- [Trigger Definition](./trigger.md) *(Coming soon)*
- [Procedure Definition](./procedure.md) *(Coming soon)*
- [Lifecycle Hooks](./lifecycle-hooks.md) *(Coming soon)*
- [Format Support](../formats/)
