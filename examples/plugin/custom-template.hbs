{{!
  Custom Handlebars Template Example

  This demonstrates how to create custom templates for JustDB.
  Templates use Handlebars syntax with JustDB-specific helpers.
}}

-- {{!--
-- Table Name: {{table.name}}
-- Description: {{#if table.remark}}{{table.remark}}{{else}}No description{{/if}}
-- Generated by: JustDB ORM Generator
-- Database: {{@root.dbType}}
-- }}

{{#if @root.idempotent}}
-- Create table only if it doesn't exist
{{/if}}

CREATE {{#if @root.idempotent}}TABLE IF NOT EXISTS{{else}}TABLE{{/if}} {{> table-name}} (
{{#each table.columns}}
  {{#unless @first}}  {{/unless}}{{this.name}} {{this.type}}{{#if this.nullable}} NULL{{else}} NOT NULL{{/if}}{{#if @root.autoIncrement}} AUTO_INCREMENT{{/if}}{{#if this.defaultValue}} DEFAULT {{this.defaultValue}}{{/if}}{{#if this.remark}} -- {{this.remark}}{{/if}}{{#unless @last}},
{{/unless}}{{/each}}

{{#if table.primaryKey}}
  PRIMARY KEY ({{#each table.primaryKey.columns}}{{this}}{{#unless @last}}, {{/unless}}{{/each}})
{{/if}}

{{#each table.indexes}}
  {{#if this.unique}}
  UNIQUE INDEX {{this.name}} ({{#each this.columns}}{{this}}{{#unless @last}}, {{/unless}}{{/each}})
  {{else}}
  INDEX {{this.name}} ({{#each this.columns}}{{this}}{{#unless @last}}, {{/unless}}{{/each}})
  {{/if}}
  {{#unless @last}},{{/unless}}
{{/each}}
);

{{#if table.remark}}
COMMENT ON TABLE {{table.name}} IS '{{table.remark}}';
{{/if}}

{{#each table.columns}}
  {{#if this.remark}}
COMMENT ON COLUMN {{@root.table.name}}.{{this.name}} IS '{{this.remark}}';
  {{/if}}
{{/each}}
